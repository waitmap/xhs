# 小红书内容发布工具使用说明

## 一、工具简介
本工具用于自动生成并发布小红书风格的教育类笔记内容，支持从CSV文件读取资料信息，通过Qwen模型生成文案、标签和封面图，并发布到指定的MCP接口。

## 二、环境准备

### 1. 必要依赖
- Python 3.x
- 所需Python库：`requests`、`pandas`、`csv`等（可通过`pip install -r requirements.txt`安装，需自行创建包含依赖的requirements文件）

### 2. 环境变量配置
需设置阿里云DashScope API密钥：
```bash
export DASHSCOPE_API_KEY="你的API密钥"
```

### 3. 文件准备
- 确保CSV文件路径正确（默认路径：`/root/kaoshi/cleaned_jingshibang_resource.csv`）
- CSV文件需包含以下列：`title`（资料标题）、`年级`（资料对应的年级）
- 程序会自动添加`已发布`和`发布时间`列（如不存在）

## 三、配置说明
可在代码配置区修改以下参数：
```python
# 状态文件和日志文件路径
STATE_FILE = "publish_state.json"
LOG_FILE = "publisher.log"

# MCP接口地址
MCP_API_URL = "http://localhost:18060/api/v1/publish"

# 模型配置
QWEN_TEXT_MODEL = "qwen-plus"
QWEN_IMAGE_MODEL = "qwen-image-plus"

# 调用参数
MAX_RETRIES = 3  # 接口调用最大重试次数
SLEEP_RANGE = (2, 5)  # 接口调用间隔(秒)
TAGS_COUNT = 3  # 生成标签数量

# 年级分组
GRADE_GROUPS = {
    "高中组": ["高一", "高二", "高三", "高中", "高考"],
    "初中组": ["初一", "初二", "初三", "中考真"]
}
```

## 四、使用步骤

### 1. 运行程序
```bash
python3 xiaohongshumcp.py
```

### 2. 操作流程
1. **数据加载**：程序会自动加载CSV文件并显示数据总量和未发布数量
   
2. **选择发布范围**：
   - 0: 高中组（包含高一、高二、高三、高中、高考）
   - 1: 初中组（包含初一、初二、初三、中考真）
   - 其他数字: 具体年级（根据CSV中实际存在的年级显示）

3. **设置每日发布数量**：
   - 输入要发布的数量（建议不超过10条）
   - 若输入数量超过可用未发布数据，会自动调整为最大可用数量

4. **自动发布流程**：
   - 程序会随机打乱待发布内容顺序
   - 依次执行：生成文案 → 生成标签 → 生成封面图 → 发布到MCP接口
   - 首次发布立即执行，后续每小时发布1条（间隔会有5-15分钟随机波动）
   - 发布成功后会更新CSV文件中的"已发布"状态和"发布时间"

## 五、日志与状态
- 日志文件：`publisher.log`（包含详细操作记录和错误信息）
- 发布状态：实时更新到CSV文件中，可通过"已发布"列查看发布状态
- 程序运行中会在控制台显示进度信息，包括：
  - 当前发布进度
  - 下一条发布时间
  - 各步骤执行结果

## 六、注意事项
1. 确保网络连接稳定，API调用需要联网
2. 若API调用失败，程序会自动重试（最多3次）
3. 若生成内容（文案/图片）失败，会跳过该条内容
4. 发布数量建议不要设置过大，避免触发平台限制
5. CSV文件在程序运行中会被自动更新，建议定期备份

## 七、常见问题
1. **API密钥错误**：检查`DASHSCOPE_API_KEY`环境变量是否正确设置
2. **CSV文件错误**：确保CSV文件存在且包含`title`和`年级`列
3. **发布失败**：检查MCP接口地址是否正确，服务是否正常运行
4. **生成内容为空**：可能是网络问题或模型调用限制，程序会自动重试
